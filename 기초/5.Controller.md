Application은 크게 stateless application과 stateless application으로 나눌 수 있다.

# Stateless Application
* 동일한 역할을 진행하는 application
* 대표 예시는 webserver 혹은 nginx
* 한 application이 죽게 되면 동일한 다른 application을 배포해주면 된다.
* 외부 유저가 접속을 할떄 트래픽을 분산해주는데 중점을 둬야 한다.
* ReplicaSet을 통해 관리

# Stateful Application
* 각 application 별로 수행하는 역할이 있는 application
* 대표 예시로는 db
* 한 application이 죽었을 때 반드시 동일한 역할을 하는 application을 재배포 해야한다.
* Internal system이 역할에 따라 접근을 하는 방식
* StatfulSet을 통해서 관리

# Stateful Set

## StatefulSet Controller
* ReplicaSet과 동일하게 replicas를 통해 재생성 될 pod의 갯수가 결정 되지만 random한 이름으로 생성되는 replicaSet과 다르게 statefulSet은 0부터 순차적으로 생성된다(pod-0, pod-1, pod-2 이런식으로 생성 되는 방식) -> 동시 생성 삭제 되는 replicaSet과 차이

## PVC, Headless Service
* Template을 통해 pod가 생성되고 추가적으로 volumeClaimTemplates를 통해서 pvc가 동적으로 생성되고 pod으로 바로 연결
* 기존 replicaSet에서는 replicas를 통해 생성된 pod들은 pvc 하나에 연결이 되는 반면, statefulSet에서는 pod 하나별 pvc가 동적으로 생성
* 기존 replicaSet에서는 replicas를 0으로 설정되면 pvc가 삭제되었지만, statefulSet에서는 pvc가 자동으로 삭제가 되지 않으며 수동으로 삭제해야 된다.
* StatefulSet에서 'serviceName'을 headless로 설정해주면 pod의 도메인 이름이 만들어지기 때문에 원하는 statefulSet의 pod과 연결이 가능하다



# Ingres
Host와 path로 구성되어 해당 host와 path 값에 맞는 컨트롤러로 트래픽을 보내준다
해당 패스로 트래픽이 들어오면 service에서 Ingress가 있는 pod으로 트래픽을 보내주고 이 팟에서 해당되는 service와 pod에 접근하게 되는 방식
![alt text](https://matthewpalmer.net/kubernetes-app-developer/articles/ingress.png)

## Service Loadbalancing
외부 트래픽이 service loadbalancing namespace의 service에 접근->해당 서비스는 해당 namespace 안의 pod을 접근 해당 pod에서 원래 접근이 되야 될 service와 pod에 접근
Ingress의 path를 참조해 해당 pod에 트래픽을 보내준다

 ## Canary Upgrade
 Ingress 안에 weight를 줘서 트래픽을 일부 canary upgrade의 실험체에 보내준다
 ![alt text](https://pek3b.qingstor.com/kubesphere-docs/png/20200229182539.png)

 ## Https
 Ingress 안에 tls 안에 secretName 값을 설정해주고 secret을 연결해준다.
 사용자는 https를 앞에 붙여야만 접근이 가능해진다


 # Autoscaler

 ## HPA
 하나의 pod에 트래픽이 많이 몰리게 되면 pod이 죽는 현상이 발생할 수 있다
 이걸 방지하기 위해 controller에 HPA를 연결해 HPA가 트래픽에 맞게 replicas의 갯수를 조절할 수 있게 해준다(scale-in, scale-out)
 기동이 빠르게 되는 app, stateless app에 적용을 해야 한다

 ## VPA
 하나의 pod에 트래픽이 많이 몰릴 경우 controller에 VPA를 연결할시 해당 pod을 restart해주고 해당 pod의 리소스를 증가하거나 감소 시킨다(scale-up, scale-down)
 Stateful app에서 사용하고 한 controller안에 HPA와 같이 사용하면 안됨


 ## CA
 스케쥴러에 연결을하여 worker node의 자원을 전부 소모했을때 worker node를 추가해 pod을 생성할 수 있게 해준다
 트래픽이 다시 적어진다면 해당 node는 삭제가 된다